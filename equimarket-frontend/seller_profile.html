<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Satƒ±cƒ± Profili - EquiMarket</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --racing-green: #1a3d2e; --racing-green-light: #2d5a47;
            --gold: #c9a55c; --gold-light: #e8d5a8; --cream: #faf8f3;
            --charcoal: #2a2a2a; --warm-gray: #6b6b6b; --light-gray: #f5f4f0; --white: #ffffff;
            --success: #4a7c59; --warning: #f59e0b; --error: #dc2626; --info: #3b82f6;
            --shadow-soft: 0 4px 20px rgba(26,61,46,0.08);
            --shadow-medium: 0 8px 40px rgba(26,61,46,0.12);
            --shadow-large: 0 20px 60px rgba(26,61,46,0.15);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'DM Sans', sans-serif; background: var(--light-gray); color: var(--charcoal); line-height: 1.6; }
        h1,h2,h3,h4 { font-family: 'Playfair Display', serif; font-weight: 600; }

        /* Header */
        .header { background: var(--white); padding: 16px 0; position: fixed; top: 0; left: 0; right: 0; z-index: 100; box-shadow: var(--shadow-soft); }
        .header-container { max-width: 1200px; margin: 0 auto; padding: 0 24px; display: flex; align-items: center; justify-content: space-between; }
        .logo { display: flex; align-items: center; gap: 10px; text-decoration: none; }
        .logo-icon { width: 40px; height: 40px; background: var(--racing-green); border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .logo-icon svg { width: 24px; height: 24px; fill: none; stroke: var(--gold); stroke-width: 1.5; }
        .logo-text { font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 700; color: var(--charcoal); }
        .logo-text span { color: var(--gold); }
        .header-actions { display: flex; align-items: center; gap: 16px; }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 24px; border-radius: 10px; font-family: 'DM Sans', sans-serif; font-size: 14px; font-weight: 600; text-decoration: none; cursor: pointer; border: none; transition: all 0.2s; }
        .btn-primary { background: var(--racing-green); color: var(--white); }
        .btn-primary:hover { background: var(--racing-green-light); }
        .btn-outline { background: transparent; color: var(--charcoal); border: 2px solid var(--light-gray); }
        .btn-outline:hover { border-color: var(--racing-green); color: var(--racing-green); }
        .btn-gold { background: var(--gold); color: var(--charcoal); }
        .btn-gold:hover { background: #b8944d; }
        .btn svg { width: 18px; height: 18px; fill: none; stroke: currentColor; stroke-width: 2; }

        /* Main */
        .main-content { padding-top: 72px; }

        /* Cover */
        .cover-section { position: relative; height: 320px; background: linear-gradient(135deg, var(--racing-green) 0%, var(--racing-green-light) 100%); overflow: hidden; }
        .cover-photo { width: 100%; height: 100%; object-fit: cover; }
        .cover-overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.4) 0%, transparent 50%); }
        .cover-pattern { position: absolute; inset: 0; opacity: 0.1; background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"); }

        /* Profile */
        .profile-section { max-width: 1200px; margin: 0 auto; padding: 0 24px; position: relative; margin-top: -80px; }
        .profile-card { background: var(--white); border-radius: 24px; box-shadow: var(--shadow-large); overflow: hidden; }
        .profile-header { display: flex; gap: 32px; padding: 32px; border-bottom: 1px solid var(--light-gray); }
        .profile-avatar-wrapper { position: relative; flex-shrink: 0; }
        .profile-avatar { width: 160px; height: 160px; border-radius: 20px; background: var(--racing-green); display: flex; align-items: center; justify-content: center; font-family: 'Playfair Display', serif; font-size: 56px; font-weight: 700; color: var(--white); border: 4px solid var(--white); box-shadow: var(--shadow-medium); overflow: hidden; margin-top: -80px; }
        .profile-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .verified-badge { position: absolute; bottom: -8px; right: -8px; width: 48px; height: 48px; background: var(--gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 3px solid var(--white); box-shadow: var(--shadow-soft); }
        .verified-badge svg { width: 24px; height: 24px; fill: none; stroke: var(--charcoal); stroke-width: 2.5; }
        .profile-info { flex: 1; padding-top: 16px; }
        .profile-name-row { display: flex; align-items: center; gap: 16px; margin-bottom: 8px; flex-wrap: wrap; }
        .profile-name { font-size: 32px; color: var(--charcoal); }
        .profile-badges { display: flex; gap: 8px; }
        .badge { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .badge-premium { background: linear-gradient(135deg, var(--gold) 0%, #e8c77b 100%); color: var(--charcoal); }
        .badge-verified { background: rgba(74,124,89,0.1); color: var(--success); }
        .profile-company { font-size: 16px; color: var(--warm-gray); margin-bottom: 12px; }
        .profile-meta { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 16px; }
        .meta-item { display: flex; align-items: center; gap: 6px; font-size: 14px; color: var(--warm-gray); }
        .meta-item svg { width: 16px; height: 16px; fill: none; stroke: currentColor; stroke-width: 2; }
        .profile-bio { font-size: 15px; color: var(--charcoal); line-height: 1.7; max-width: 600px; }
        .profile-actions { display: flex; flex-direction: column; gap: 12px; padding-top: 16px; }
        .profile-stats { display: flex; gap: 32px; margin-bottom: 16px; }
        .stat-item { text-align: center; }
        .stat-value { font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 700; color: var(--charcoal); }
        .stat-label { font-size: 13px; color: var(--warm-gray); }
        .social-links { display: flex; gap: 12px; }
        .social-link { width: 40px; height: 40px; border-radius: 10px; background: var(--light-gray); display: flex; align-items: center; justify-content: center; color: var(--warm-gray); text-decoration: none; transition: all 0.2s; }
        .social-link:hover { background: var(--racing-green); color: var(--white); }
        .social-link svg { width: 20px; height: 20px; fill: currentColor; }

        /* Rating */
        .rating-section { display: flex; align-items: center; gap: 12px; padding: 20px 32px; background: var(--light-gray); }
        .rating-stars { display: flex; gap: 4px; }
        .rating-stars svg { width: 20px; height: 20px; fill: var(--gold); }
        .rating-stars svg.empty { fill: #ddd; }
        .rating-value { font-weight: 700; font-size: 18px; color: var(--charcoal); }
        .rating-count { color: var(--warm-gray); font-size: 14px; }

        /* Specialties */
        .specialties-section { padding: 24px 32px; border-bottom: 1px solid var(--light-gray); }
        .section-title { font-size: 14px; font-weight: 600; color: var(--warm-gray); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }
        .specialties-list { display: flex; flex-wrap: wrap; gap: 8px; }
        .specialty-tag { padding: 8px 16px; background: var(--cream); border-radius: 20px; font-size: 13px; font-weight: 500; color: var(--racing-green); border: 1px solid rgba(26,61,46,0.1); }

        /* Tabs */
        .tabs-section { border-bottom: 1px solid var(--light-gray); }
        .tabs { display: flex; padding: 0 32px; }
        .tab-btn { padding: 20px 24px; background: none; border: none; font-family: 'DM Sans', sans-serif; font-size: 15px; font-weight: 600; color: var(--warm-gray); cursor: pointer; position: relative; transition: color 0.2s; }
        .tab-btn:hover { color: var(--charcoal); }
        .tab-btn.active { color: var(--racing-green); }
        .tab-btn.active::after { content: ''; position: absolute; bottom: 0; left: 24px; right: 24px; height: 3px; background: var(--gold); border-radius: 3px 3px 0 0; }
        .tab-count { background: var(--light-gray); padding: 2px 8px; border-radius: 10px; font-size: 12px; margin-left: 8px; }
        .tab-btn.active .tab-count { background: rgba(201,165,92,0.2); color: var(--gold); }

        /* Tab Content */
        .tab-content { padding: 32px; }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        /* Listings Grid */
        .listings-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 24px; }
        .listing-card { background: var(--white); border-radius: 16px; overflow: hidden; box-shadow: var(--shadow-soft); transition: all 0.3s; border: 1px solid var(--light-gray); }
        .listing-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-medium); }
        .listing-image { position: relative; height: 200px; background: var(--light-gray); overflow: hidden; }
        .listing-image img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; }
        .listing-card:hover .listing-image img { transform: scale(1.05); }
        .listing-image-placeholder { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        .listing-image-placeholder svg { width: 60px; height: 60px; fill: none; stroke: var(--warm-gray); stroke-width: 1; opacity: 0.5; }
        .listing-badge { position: absolute; top: 12px; left: 12px; padding: 6px 12px; border-radius: 8px; font-size: 11px; font-weight: 700; text-transform: uppercase; }
        .listing-badge.featured { background: var(--gold); color: var(--charcoal); }
        .listing-info { padding: 20px; }
        .listing-title { font-size: 18px; margin-bottom: 8px; color: var(--charcoal); }
        .listing-meta { display: flex; gap: 12px; font-size: 13px; color: var(--warm-gray); margin-bottom: 12px; }
        .listing-price { font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 700; color: var(--racing-green); }
        .listing-link { text-decoration: none; color: inherit; }

        /* Empty State */
        .empty-state { text-align: center; padding: 60px; }
        .empty-state svg { width: 80px; height: 80px; fill: none; stroke: var(--warm-gray); stroke-width: 1; opacity: 0.4; margin-bottom: 20px; }
        .empty-state h3 { font-size: 20px; color: var(--charcoal); margin-bottom: 8px; }
        .empty-state p { color: var(--warm-gray); }

        /* Modal */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; padding: 24px; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--white); border-radius: 24px; padding: 32px; max-width: 480px; width: 100%; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .modal-header h3 { font-size: 24px; }
        .modal-close { width: 40px; height: 40px; border: none; background: var(--light-gray); border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--warm-gray); }
        .modal-close:hover { background: var(--charcoal); color: var(--white); }
        .modal-close svg { width: 20px; height: 20px; fill: none; stroke: currentColor; stroke-width: 2; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 14px; font-weight: 600; color: var(--charcoal); margin-bottom: 8px; }
        .form-input, .form-textarea { width: 100%; padding: 14px 16px; border: 2px solid var(--light-gray); border-radius: 12px; font-family: 'DM Sans', sans-serif; font-size: 15px; }
        .form-input:focus, .form-textarea:focus { outline: none; border-color: var(--gold); }
        .form-textarea { min-height: 120px; resize: vertical; }

        @media (max-width: 768px) {
            .cover-section { height: 200px; }
            .profile-header { flex-direction: column; align-items: center; text-align: center; padding: 24px; }
            .profile-avatar { width: 120px; height: 120px; font-size: 40px; margin-top: -60px; }
            .profile-name { font-size: 24px; }
            .profile-meta { justify-content: center; }
            .profile-actions { width: 100%; }
            .profile-stats { justify-content: center; }
            .social-links { justify-content: center; }
            .tabs { overflow-x: auto; padding: 0 16px; }
            .tab-btn { padding: 16px; white-space: nowrap; }
            .tab-content { padding: 20px; }
            .listings-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-container">
            <a href="homepage_v2.html" class="logo">
                <div class="logo-icon"><svg viewBox="0 0 24 24"><path d="M20.5 6c-.2-1.5-1-2.5-2-3-.5-1.3-1.5-2-3-2-1 0-2 .5-2.5 1.3L11.5 4 9 3 5 5 3 8v5l2.5 2.5H9l4-2.5 3 1c2.2 0 3.5-1.5 3.5-4V6zM15 5.5a1 1 0 110 2 1 1 0 010-2zM7 15v5M11 13v7"/></svg></div>
                <div class="logo-text">Equi<span>Market</span></div>
            </a>
            <div class="header-actions">
                <a href="ilanlar.html" class="btn btn-outline"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>ƒ∞lanlarƒ± Ke≈üfet</a>
                <a href="login_register.html" class="btn btn-primary" id="authBtn">Giri≈ü Yap</a>
            </div>
        </div>
    </header>

    <main class="main-content">
        <section class="cover-section" id="coverSection"><div class="cover-pattern"></div><div class="cover-overlay"></div></section>

        <section class="profile-section">
            <div class="profile-card">
                <div class="profile-header">
                    <div class="profile-avatar-wrapper">
                        <div class="profile-avatar" id="profileAvatar"></div>
                        <div class="verified-badge" id="verifiedBadge" style="display:none;"><svg viewBox="0 0 24 24"><path d="M20 6L9 17l-5-5"/></svg></div>
                    </div>
                    <div class="profile-info">
                        <div class="profile-name-row">
                            <h1 class="profile-name" id="profileName">Y√ºkleniyor...</h1>
                            <div class="profile-badges" id="profileBadges"></div>
                        </div>
                        <div class="profile-company" id="profileCompany"></div>
                        <div class="profile-meta" id="profileMeta"></div>
                        <p class="profile-bio" id="profileBio"></p>
                        <div class="social-links" id="socialLinks"></div>
                    </div>
                    <div class="profile-actions">
                        <div class="profile-stats">
                            <div class="stat-item"><div class="stat-value" id="statListings">0</div><div class="stat-label">Aktif ƒ∞lan</div></div>
                            <div class="stat-item"><div class="stat-value" id="statSales">0</div><div class="stat-label">Satƒ±≈ü</div></div>
                            <div class="stat-item"><div class="stat-value" id="statReviews">0</div><div class="stat-label">Deƒüerlendirme</div></div>
                        </div>
                        <button class="btn btn-gold" onclick="openContactModal()"><svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>ƒ∞leti≈üime Ge√ß</button>
                    </div>
                </div>

                <div class="rating-section">
                    <div class="rating-stars" id="ratingStars"></div>
                    <span class="rating-value" id="ratingValue">0.0</span>
                    <span class="rating-count" id="ratingCount">(0 deƒüerlendirme)</span>
                </div>

                <div class="specialties-section" id="specialtiesSection" style="display:none;">
                    <div class="section-title">Uzmanlƒ±k Alanlarƒ±</div>
                    <div class="specialties-list" id="specialtiesList"></div>
                </div>

                <div class="tabs-section">
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchTab(event,'listings')">ƒ∞lanlar<span class="tab-count" id="listingsCount">0</span></button>
                        <button class="tab-btn" onclick="switchTab(event,'reviews')">Deƒüerlendirmeler<span class="tab-count" id="reviewsCount">0</span></button>
                    </div>
                </div>

                <div class="tab-content">
                    <div class="tab-panel active" id="listingsPanel">
                        <div class="listings-grid" id="listingsGrid"><div class="empty-state"><h3>Y√ºkleniyor...</h3></div></div>
                    </div>
                    <div class="tab-panel" id="reviewsPanel">
                        <div class="reviews-header" id="reviewsHeader" style="display:none;margin-bottom:24px;">
                            <button class="btn btn-gold" onclick="openReviewModal()">
                                <svg viewBox="0 0 24 24" style="width:18px;height:18px;"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                                Deƒüerlendirme Yap
                            </button>
                        </div>
                        <div class="reviews-list" id="reviewsList">
                            <div class="empty-state"><svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg><h3>Hen√ºz deƒüerlendirme yok</h3><p>Bu satƒ±cƒ± hen√ºz deƒüerlendirilmemi≈ü</p></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div class="modal-overlay" id="contactModal">
        <div class="modal">
            <div class="modal-header"><h3>ƒ∞leti≈üime Ge√ß</h3><button class="modal-close" onclick="closeContactModal()"><svg viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div>
            <form id="contactForm" onsubmit="sendMessage(event)">
                <div class="form-group"><label class="form-label">Konu</label><input type="text" class="form-input" id="messageSubject" placeholder="Mesajƒ±nƒ±zƒ±n konusu" required></div>
                <div class="form-group"><label class="form-label">Mesajƒ±nƒ±z</label><textarea class="form-textarea" id="messageContent" placeholder="Satƒ±cƒ±ya iletmek istediƒüiniz mesaj..." required></textarea></div>
                <button type="submit" class="btn btn-gold" style="width:100%;"><svg viewBox="0 0 24 24"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>Mesaj G√∂nder</button>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="reviewModal">
        <div class="modal" style="max-width:500px;">
            <div class="modal-header"><h3>Deƒüerlendirme Yap</h3><button class="modal-close" onclick="closeReviewModal()"><svg viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg></button></div>
            <form id="reviewForm" onsubmit="submitReview(event)">
                <div class="form-group">
                    <label class="form-label">Puanƒ±nƒ±z</label>
                    <div class="star-rating" id="starRating">
                        <span class="star" data-value="1">‚òÖ</span>
                        <span class="star" data-value="2">‚òÖ</span>
                        <span class="star" data-value="3">‚òÖ</span>
                        <span class="star" data-value="4">‚òÖ</span>
                        <span class="star" data-value="5">‚òÖ</span>
                    </div>
                    <input type="hidden" id="reviewRating" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Yorumunuz</label>
                    <textarea class="form-textarea" id="reviewComment" placeholder="Bu satƒ±cƒ± hakkƒ±ndaki deneyiminizi payla≈üƒ±n..." required minlength="10" maxlength="500"></textarea>
                    <span style="font-size:12px;color:var(--warm-gray);">En az 10, en fazla 500 karakter</span>
                </div>
                <button type="submit" class="btn btn-gold" style="width:100%;">Deƒüerlendirmeyi G√∂nder</button>
            </form>
        </div>
    </div>

    <style>
        .star-rating { display: flex; gap: 8px; font-size: 32px; }
        .star-rating .star { color: #ddd; cursor: pointer; transition: color 0.2s; }
        .star-rating .star:hover, .star-rating .star.active { color: var(--gold); }
        .review-card { background: var(--white); border-radius: 12px; padding: 20px; margin-bottom: 16px; border: 1px solid var(--light-gray); }
        .review-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .review-avatar { width: 44px; height: 44px; border-radius: 50%; background: var(--gold); display: flex; align-items: center; justify-content: center; font-weight: 700; color: var(--charcoal); overflow: hidden; }
        .review-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .review-info { flex: 1; }
        .review-name { font-weight: 600; color: var(--charcoal); }
        .review-date { font-size: 13px; color: var(--warm-gray); }
        .review-stars { display: flex; gap: 2px; }
        .review-stars svg { width: 16px; height: 16px; fill: var(--gold); }
        .review-stars svg.empty { fill: #ddd; }
        .review-comment { color: var(--charcoal); line-height: 1.6; margin-bottom: 12px; }
        .review-response { background: var(--light-gray); border-radius: 8px; padding: 12px; margin-top: 12px; }
        .review-response-label { font-size: 12px; font-weight: 600; color: var(--racing-green); margin-bottom: 4px; }
        .review-helpful { display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--warm-gray); }
        .review-helpful button { background: none; border: 1px solid var(--light-gray); padding: 4px 12px; border-radius: 20px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 4px; }
        .review-helpful button:hover { border-color: var(--racing-green); color: var(--racing-green); }
        .review-helpful button.active { background: var(--racing-green); color: white; border-color: var(--racing-green); }
    </style>

    <link rel="stylesheet" href="css/toast.css">
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/toast.js"></script>
    <script>
        let sellerId = null, sellerData = null, sellerListings = [], sellerReviews = [];
        let selectedRating = 0;

        document.addEventListener('DOMContentLoaded', async function() {
            const urlParams = new URLSearchParams(window.location.search);
            sellerId = urlParams.get('id');

            // ID yoksa veya "undefined" string ise
            if (!sellerId || sellerId === 'undefined' || sellerId === 'null') {
                // Kendi profilini g√∂rmek istiyor olabilir - backend'den al
                if (api.isLoggedIn()) {
                    try {
                        const meResponse = await api.get('/auth/me');
                        if (meResponse.success && meResponse.data) {
                            api.setUser(meResponse.data);
                            sellerId = meResponse.data._id || meResponse.data.id;
                        }
                    } catch(e) {}
                }
                if (!sellerId || sellerId === 'undefined') {
                    toast.error('Satƒ±cƒ± bulunamadƒ±');
                    setTimeout(()=>window.location.href='ilanlar.html',1500);
                    return;
                }
            }
            loadSellerProfile();
            initStarRating();
        });

        // Yƒ±ldƒ±z rating se√ßimi
        function initStarRating() {
            const stars = document.querySelectorAll('#starRating .star');
            stars.forEach(star => {
                star.addEventListener('click', () => {
                    selectedRating = parseInt(star.dataset.value);
                    document.getElementById('reviewRating').value = selectedRating;
                    stars.forEach((s, i) => {
                        s.classList.toggle('active', i < selectedRating);
                    });
                });
                star.addEventListener('mouseenter', () => {
                    const val = parseInt(star.dataset.value);
                    stars.forEach((s, i) => {
                        s.style.color = i < val ? 'var(--gold)' : '#ddd';
                    });
                });
            });
            document.getElementById('starRating').addEventListener('mouseleave', () => {
                const stars = document.querySelectorAll('#starRating .star');
                stars.forEach((s, i) => {
                    s.style.color = i < selectedRating ? 'var(--gold)' : '#ddd';
                });
            });
        }

        async function loadSellerProfile() {
            try {
                const result = await api.get('/users/seller/' + sellerId);
                if (!result.success) throw new Error(result.message);
                sellerData = result.data;
                renderProfile();
                loadSellerListings();
                loadSellerReviews();
            } catch (e) {
                console.error('Seller profile load error:', e);
                document.getElementById('profileName').textContent = 'Profil y√ºklenemedi';
                toast.error('Satƒ±cƒ± profili y√ºklenirken bir hata olu≈ütu');
            }
        }

        async function loadSellerReviews() {
            try {
                const result = await api.get('/reviews/seller/' + sellerId);
                if (result.success) {
                    sellerReviews = result.data;
                    
                    // Stats g√ºncelle
                    if (result.stats) {
                        document.getElementById('ratingValue').textContent = (result.stats.averageRating || 0).toFixed(1);
                        document.getElementById('ratingCount').textContent = '(' + (result.stats.totalReviews || 0) + ' deƒüerlendirme)';
                        document.getElementById('reviewsCount').textContent = result.stats.totalReviews || 0;
                        document.getElementById('statReviews').textContent = result.stats.totalReviews || 0;
                        
                        // Stars g√ºncelle
                        const rating = result.stats.averageRating || 0;
                        let stars = '';
                        for (let i = 1; i <= 5; i++) stars += '<svg viewBox="0 0 24 24"' + (i > Math.round(rating) ? ' class="empty"' : '') + '><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';
                        document.getElementById('ratingStars').innerHTML = stars;
                    }

                    renderReviews();
                }
            } catch (e) { console.error('Reviews error:', e); }
        }

        function renderReviews() {
            const container = document.getElementById('reviewsList');
            const currentUser = api.getUser();
            
            // Deƒüerlendirme butonu g√∂ster (kendi profilin deƒüilse)
            if (currentUser && currentUser._id !== sellerId) {
                document.getElementById('reviewsHeader').style.display = 'block';
            }

            if (!sellerReviews.length) {
                container.innerHTML = '<div class="empty-state"><svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg><h3>Hen√ºz deƒüerlendirme yok</h3><p>Bu satƒ±cƒ± hen√ºz deƒüerlendirilmemi≈ü</p></div>';
                return;
            }

            container.innerHTML = sellerReviews.map(r => {
                const reviewer = r.reviewer || {};
                const initials = reviewer.name ? reviewer.name.substring(0,2).toUpperCase() : '?';
                const date = new Date(r.createdAt).toLocaleDateString('tr-TR', {year:'numeric', month:'long', day:'numeric'});
                
                let stars = '';
                for (let i = 1; i <= 5; i++) stars += '<svg viewBox="0 0 24 24"' + (i > r.rating ? ' class="empty"' : '') + '><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';

                const isHelpful = currentUser && r.helpfulBy?.includes(currentUser._id);

                return `
                    <div class="review-card">
                        <div class="review-header">
                            <div class="review-avatar">
                                ${reviewer.avatar ? '<img src="' + reviewer.avatar + '">' : initials}
                            </div>
                            <div class="review-info">
                                <div class="review-name">${reviewer.name || 'Anonim'}</div>
                                <div class="review-date">${date}</div>
                            </div>
                            <div class="review-stars">${stars}</div>
                        </div>
                        <div class="review-comment">${r.comment}</div>
                        ${r.sellerResponse ? `
                            <div class="review-response">
                                <div class="review-response-label">Satƒ±cƒ± Yanƒ±tƒ±</div>
                                <div>${r.sellerResponse.comment}</div>
                            </div>
                        ` : ''}
                        <div class="review-helpful">
                            <button class="${isHelpful ? 'active' : ''}" onclick="markHelpful('${r._id}')">
                                üëç Yararlƒ± (${r.helpfulCount || 0})
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openReviewModal() {
            if (!api.getUser()) {
                toast.warning('Deƒüerlendirme yapmak i√ßin giri≈ü yapmalƒ±sƒ±nƒ±z');
                setTimeout(()=>window.location.href='login_register.html',1500);
                return;
            }
            document.getElementById('reviewModal').classList.add('active');
        }
        
        function closeReviewModal() { 
            document.getElementById('reviewModal').classList.remove('active'); 
        }

        async function submitReview(e) {
            e.preventDefault();
            
            const rating = parseInt(document.getElementById('reviewRating').value);
            const comment = document.getElementById('reviewComment').value.trim();

            if (!rating || rating < 1) {
                toast.warning('L√ºtfen bir puan se√ßin');
                return;
            }

            if (comment.length < 10) {
                toast.warning('Yorum en az 10 karakter olmalƒ±dƒ±r');
                return;
            }

            try {
                const result = await api.post('/reviews', {
                    sellerId: sellerId,
                    rating: rating,
                    comment: comment
                });

                if (result.success) {
                    toast.success('Deƒüerlendirmeniz kaydedildi!');
                    closeReviewModal();
                    loadSellerReviews();
                    document.getElementById('reviewForm').reset();
                    selectedRating = 0;
                    document.querySelectorAll('#starRating .star').forEach(s => s.classList.remove('active'));
                } else {
                    toast.error(result.message || 'Bir hata olu≈ütu');
                }
            } catch (error) {
                toast.error('Bir hata olu≈ütu');
            }
        }

        async function markHelpful(reviewId) {
            if (!api.getUser()) {
                toast.warning('Giri≈ü yapmalƒ±sƒ±nƒ±z');
                return;
            }
            try {
                const result = await api.post('/reviews/' + reviewId + '/helpful');
                if (result.success) {
                    loadSellerReviews();
                }
            } catch (e) { console.error(e); }
        }

        function renderProfile() {
            const s = sellerData;
            document.title = s.name + ' - EquiMarket';

            // Cover
            if (s.coverPhoto) {
                document.getElementById('coverSection').innerHTML = '<img src="' + s.coverPhoto + '" class="cover-photo"><div class="cover-overlay"></div>';
            }

            // Avatar
            const av = document.getElementById('profileAvatar');
            if (s.avatar) av.innerHTML = '<img src="' + s.avatar + '">';
            else av.textContent = s.name.substring(0,2).toUpperCase();

            // Verified
            if (s.sellerInfo?.isVerifiedSeller) document.getElementById('verifiedBadge').style.display = 'flex';

            // Name & badges
            document.getElementById('profileName').textContent = s.name;
            let badges = '';
            if (s.sellerInfo?.isVerifiedSeller) badges += '<span class="badge badge-verified">‚úì Doƒürulanmƒ±≈ü</span>';
            if (s.subscription?.plan === 'premium') badges += '<span class="badge badge-premium">‚≠ê Premium</span>';
            document.getElementById('profileBadges').innerHTML = badges;

            // Company
            if (s.sellerInfo?.companyName) document.getElementById('profileCompany').textContent = s.sellerInfo.companyName;

            // Meta
            let meta = '';
            if (s.location?.city) meta += '<span class="meta-item"><svg viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>' + s.location.city + '</span>';
            if (s.createdAt) meta += '<span class="meta-item"><svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>' + new Date(s.createdAt).toLocaleDateString('tr-TR',{year:'numeric',month:'long'}) + "'dan beri √ºye</span>";
            document.getElementById('profileMeta').innerHTML = meta;

            // Bio
            if (s.bio) document.getElementById('profileBio').textContent = s.bio;

            // Social
            let social = '';
            if (s.socialLinks?.instagram) social += '<a href="' + s.socialLinks.instagram + '" target="_blank" class="social-link"><svg viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="20" rx="5"/><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"/></svg></a>';
            if (s.socialLinks?.facebook) social += '<a href="' + s.socialLinks.facebook + '" target="_blank" class="social-link"><svg viewBox="0 0 24 24"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></a>';
            if (s.socialLinks?.youtube) social += '<a href="' + s.socialLinks.youtube + '" target="_blank" class="social-link"><svg viewBox="0 0 24 24"><path d="M22.54 6.42a2.78 2.78 0 00-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 00-1.94 2A29 29 0 001 11.75a29 29 0 00.46 5.33A2.78 2.78 0 003.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 001.94-2 29 29 0 00.46-5.25 29 29 0 00-.46-5.33z"/><polygon points="9.75,15.02 15.5,11.75 9.75,8.48"/></svg></a>';
            document.getElementById('socialLinks').innerHTML = social;

            // Stats
            document.getElementById('statSales').textContent = s.sellerInfo?.totalSales || 0;
            document.getElementById('statReviews').textContent = s.sellerInfo?.totalReviews || 0;
            document.getElementById('reviewsCount').textContent = s.sellerInfo?.totalReviews || 0;

            // Rating
            const rating = s.sellerInfo?.rating || 0;
            document.getElementById('ratingValue').textContent = rating.toFixed(1);
            document.getElementById('ratingCount').textContent = '(' + (s.sellerInfo?.totalReviews || 0) + ' deƒüerlendirme)';
            let stars = '';
            for (let i = 1; i <= 5; i++) stars += '<svg viewBox="0 0 24 24"' + (i > Math.round(rating) ? ' class="empty"' : '') + '><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';
            document.getElementById('ratingStars').innerHTML = stars;

            // Specialties
            if (s.sellerInfo?.specialties?.length) {
                document.getElementById('specialtiesSection').style.display = 'block';
                document.getElementById('specialtiesList').innerHTML = s.sellerInfo.specialties.map(x => '<span class="specialty-tag">' + x + '</span>').join('');
            }
        }

        async function loadSellerListings() {
            try {
                const r = await api.get('/horses?seller=' + sellerId + '&status=active');
                if (r.success) {
                    sellerListings = r.data;
                    document.getElementById('statListings').textContent = sellerListings.length;
                    document.getElementById('listingsCount').textContent = sellerListings.length;
                    renderListings();
                }
            } catch (e) { console.error(e); }
        }

        function renderListings() {
            const grid = document.getElementById('listingsGrid');
            if (!sellerListings.length) {
                grid.innerHTML = '<div class="empty-state"><svg viewBox="0 0 24 24"><path d="M20.5 6c-.2-1.5-1-2.5-2-3-.5-1.3-1.5-2-3-2-1 0-2 .5-2.5 1.3L11.5 4 9 3 5 5 3 8v5l2.5 2.5H9l4-2.5 3 1c2.2 0 3.5-1.5 3.5-4V6z"/></svg><h3>Hen√ºz ilan yok</h3><p>Bu satƒ±cƒ±nƒ±n aktif ilanƒ± bulunmuyor</p></div>';
                return;
            }
            grid.innerHTML = sellerListings.map(l => {
                const img = l.images?.[0]?.url;
                return '<a href="horse_detail.html#id=' + l._id + '" class="listing-link"><div class="listing-card"><div class="listing-image">' + (img ? '<img src="' + img + '">' : '<div class="listing-image-placeholder"><svg viewBox="0 0 24 24"><path d="M20.5 6c-.2-1.5-1-2.5-2-3-.5-1.3-1.5-2-3-2-1 0-2 .5-2.5 1.3L11.5 4 9 3 5 5 3 8v5l2.5 2.5H9l4-2.5 3 1c2.2 0 3.5-1.5 3.5-4V6z"/></svg></div>') + (l.isFeatured ? '<span class="listing-badge featured">√ñne √áƒ±kan</span>' : '') + '</div><div class="listing-info"><h3 class="listing-title">' + l.name + '</h3><div class="listing-meta"><span>' + (l.age || '?') + ' Ya≈ü</span><span>' + (l.breed || '') + '</span><span>' + (l.location?.city || '') + '</span></div><div class="listing-price">‚Ç∫' + formatNumber(l.price) + '</div></div></div></a>';
            }).join('');
        }

        function switchTab(e, tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            document.getElementById(tab + 'Panel').classList.add('active');
        }

        function openContactModal() {
            if (!api.getUser()) { toast.warning('Mesaj g√∂ndermek i√ßin giri≈ü yapmalƒ±sƒ±nƒ±z'); setTimeout(()=>window.location.href='login_register.html',1500); return; }
            document.getElementById('contactModal').classList.add('active');
        }
        function closeContactModal() { document.getElementById('contactModal').classList.remove('active'); }
        function sendMessage(e) {
            e.preventDefault();
            toast.info('Mesajla≈üma sayfasƒ±na y√∂nlendiriliyorsunuz...');
            setTimeout(()=>window.location.href='messaging?to='+sellerId,1000);
        }
        function formatNumber(n) { return new Intl.NumberFormat('tr-TR').format(n || 0); }
    </script>
</body>
</html>
