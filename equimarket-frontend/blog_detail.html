>

    <link rel="stylesheet" href="css/toast.css">
    <script src="js/api.js"></script>
    <script src="js/toast.js"></script>
    <script>
        const catLabels = { haberler:'Haberler', rehber:'Rehber', bakım:'Bakım', eğitim:'Eğitim', yarış:'Yarış', sağlık:'Sağlık', beslenme:'Beslenme', ekipman:'Ekipman', etkinlik:'Etkinlik', diğer:'Diğer' };

        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const slug = params.get('slug');
            if (!slug) { window.location.href = 'blog.html'; return; }
            loadBlog(slug);
        });

        async function loadBlog(slug) {
            try {
                const r = await api.get('/blogs/' + slug);
                if (!r.success) throw new Error(r.message);
                renderBlog(r.data, r.related);
            } catch (e) {
                document.getElementById('articleContainer').innerHTML = `
                    <div class="loading">
                        <h2>Blog yazısı bulunamadı</h2>
                        <p style="margin-top:16px"><a href="blog.html" class="btn btn-primary">Blog'a Dön</a></p>
                    </div>
                `;
            }
        }

        function renderBlog(blog, related) {
            document.title = blog.title + ' - EquiMarket Blog';
            
            let html = `
                <header class="article-header">
                    <div class="article-header-container">
                        <nav class="breadcrumb">
                            <a href="homepage_v2.html">Ana Sayfa</a> / 
                            <a href="blog.html">Blog</a> / 
                            <span>${blog.title}</span>
                        </nav>
                        <span class="cat-tag">${catLabels[blog.category] || blog.category}</span>
                        <h1 class="article-title">${blog.title}</h1>
                        <div class="article-meta">
                            <div class="author-info">
                                <div class="author-avatar">
                                    ${blog.author?.avatar ? `<img src="${blog.author.avatar}">` : (blog.author?.name || 'A').substring(0, 2).toUpperCase()}
                                </div>
                                <div>
                                    <div class="author-name">${blog.author?.name || 'Admin'}</div>
                                    <div class="author-role">Yazar</div>
                                </div>
                            </div>
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                                ${formatDate(blog.publishedAt)}
                            </div>
                            <div class="meta-item">
                                <svg viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                ${blog.views.toLocaleString('tr-TR')} görüntülenme
                            </div>
                        </div>
                    </div>
                </header>
            `;

            if (blog.coverImage) {
                html += `<div class="cover-image"><img src="${blog.coverImage}" alt="${blog.title}"></div>`;
            }

            html += `
                <article class="article-content">
                    <div class="article-body">${blog.content}</div>
                    ${blog.tags?.length ? `
                        <div class="article-tags">
                            ${blog.tags.map(t => `<a href="blog.html?tag=${encodeURIComponent(t)}" class="tag">#${t}</a>`).join('')}
                        </div>
                    ` : ''}
                    <div class="share-section">
                        <span>Paylaş:</span>
                        <button class="share-btn" onclick="share('twitter')" title="Twitter"><svg viewBox="0 0 24 24"><path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/></svg></button>
                        <button class="share-btn" onclick="share('facebook')" title="Facebook"><svg viewBox="0 0 24 24"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></button>
                        <button class="share-btn" onclick="share('linkedin')" title="LinkedIn"><svg viewBox="0 0 24 24"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-4 0v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></button>
                        <button class="share-btn" onclick="share('copy')" title="Linki Kopyala"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg></button>
                    </div>
                </article>
            `;

            if (related?.length) {
                html += `
                    <section class="related-section">
                        <h2 class="section-title">İlgili Yazılar</h2>
                        <div class="related-grid">
                            ${related.map(r => `
                                <a href="blog_detail?slug=${r.slug}" class="related-card">
                                    <div class="related-card-image">
                                        ${r.coverImage ? `<img src="${r.coverImage}" alt="${r.title}">` : ''}
                                    </div>
                                    <div class="related-card-content">
                                        <h3>${r.title}</h3>
                                        <div class="date">${formatDate(r.publishedAt)}</div>
                                    </div>
                                </a>
                            `).join('')}
                        </div>
                    </section>
                `;
            }

            document.getElementById('articleContainer').innerHTML = html;
        }

        function formatDate(d) {
            if (!d) return '';
            return new Date(d).toLocaleDateString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric' });
        }

        function share(platform) {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent(document.title);
            let shareUrl;
            switch (platform) {
                case 'twitter': shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${title}`; break;
                case 'facebook': shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`; break;
                case 'linkedin': shareUrl = `https://www.linkedin.com/shareArticle?mini=true&url=${url}&title=${title}`; break;
                case 'copy':
                    navigator.clipboard.writeText(window.location.href);
                    toast.success('Link kopyalandı!');
                    return;
            }
            window.open(shareUrl, '_blank', 'width=600,height=400');
        }
    </script>
</body>
</html>
