<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Y√∂netimi - EquiMarket Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/toast.css">
    <style>
        :root{--racing-green:#1a3d2e;--gold:#c9a55c;--charcoal:#2a2a2a;--warm-gray:#6b6b6b;--light-gray:#f5f4f0;--white:#fff;--success:#4a7c59;--warning:#f59e0b;--error:#dc2626;--info:#3b82f6;--shadow-soft:0 4px 20px rgba(26,61,46,.08)}
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;background:var(--charcoal);color:var(--white)}h1,h2,h3{font-family:'Playfair Display',serif}
        .layout{display:flex;min-height:100vh}.sidebar{background:#1a1a1a;width:260px;padding:24px 16px;position:fixed;top:0;bottom:0;left:0;border-right:1px solid rgba(255,255,255,.1)}
        .sidebar-logo{display:flex;align-items:center;gap:12px;margin-bottom:32px;text-decoration:none;color:var(--white);font-size:20px;font-weight:700}
        .logo-badge{background:var(--error);font-size:10px;padding:2px 6px;border-radius:4px;margin-left:8px}
        .nav-section-title{font-size:10px;text-transform:uppercase;letter-spacing:1px;color:rgba(255,255,255,.4);padding:0 12px;margin:16px 0 8px}
        .nav-link{display:flex;align-items:center;gap:12px;padding:12px;color:rgba(255,255,255,.6);text-decoration:none;border-radius:8px;margin-bottom:4px;font-size:14px}
        .nav-link:hover{background:rgba(255,255,255,.05);color:var(--white)}.nav-link.active{background:var(--gold);color:var(--charcoal)}
        .nav-link svg{width:20px;height:20px;fill:none;stroke:currentColor;stroke-width:2}
        .main{flex:1;margin-left:260px;padding:32px;background:var(--light-gray);min-height:100vh}
        .page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.page-header h1{font-size:28px;color:var(--charcoal)}
        .stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}
        .stat-card{background:var(--white);border-radius:12px;padding:20px;box-shadow:var(--shadow-soft)}
        .stat-value{font-size:28px;font-weight:700;color:var(--charcoal)}.stat-label{font-size:13px;color:var(--warm-gray)}
        .filters{display:flex;gap:12px;margin-bottom:24px;flex-wrap:wrap}
        .search-input,.filter-select{padding:12px 16px;border:2px solid var(--light-gray);border-radius:10px;font-size:14px;background:var(--white)}
        .search-input{flex:1;min-width:200px}
        .card{background:var(--white);border-radius:16px;box-shadow:var(--shadow-soft);overflow:hidden}
        .table{width:100%;border-collapse:collapse}.table th,.table td{padding:16px 20px;text-align:left}
        .table th{background:var(--light-gray);font-size:11px;text-transform:uppercase;color:var(--warm-gray)}.table td{border-bottom:1px solid var(--light-gray)}
        .blog-cell{display:flex;align-items:center;gap:16px}.blog-img{width:80px;height:50px;border-radius:8px;background:var(--light-gray);object-fit:cover}
        .badge{padding:4px 10px;border-radius:6px;font-size:11px;font-weight:600;text-transform:uppercase}
        .badge-published{background:rgba(74,124,89,.1);color:var(--success)}.badge-draft{background:rgba(245,158,11,.1);color:var(--warning)}.badge-archived{background:rgba(107,107,107,.1);color:var(--warm-gray)}
        .action-btn{width:34px;height:34px;border:none;background:var(--light-gray);border-radius:8px;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;margin-right:4px;color:var(--warm-gray)}
        .action-btn:hover{background:var(--racing-green);color:var(--white)}.action-btn.danger:hover{background:var(--error)}
        .action-btn svg{width:16px;height:16px;fill:none;stroke:currentColor;stroke-width:2}
        .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 20px;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;border:none;text-decoration:none}
        .btn-primary{background:var(--racing-green);color:var(--white)}.btn-secondary{background:var(--light-gray);color:var(--charcoal)}
        .btn svg{width:18px;height:18px;fill:none;stroke:currentColor;stroke-width:2}
        .pagination{display:flex;justify-content:space-between;padding:20px;border-top:1px solid var(--light-gray)}
        .page-btn{padding:8px 14px;border:1px solid var(--light-gray);background:var(--white);border-radius:8px;cursor:pointer;margin-left:4px}
        .page-btn.active{background:var(--racing-green);color:var(--white)}.page-btn:disabled{opacity:.5}
        
        /* Modal */
        .modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:1000;align-items:flex-start;justify-content:center;padding:40px;overflow-y:auto}
        .modal-overlay.active{display:flex}
        .modal{background:var(--white);border-radius:20px;max-width:900px;width:100%;margin:auto}
        .modal-header{display:flex;justify-content:space-between;align-items:center;padding:24px 32px;border-bottom:1px solid var(--light-gray)}
        .modal-header h3{font-size:22px;color:var(--charcoal)}
        .modal-close{width:40px;height:40px;border:none;background:var(--light-gray);border-radius:10px;cursor:pointer;display:flex;align-items:center;justify-content:center}
        .modal-close svg{width:20px;height:20px;fill:none;stroke:var(--charcoal);stroke-width:2}
        .modal-body{padding:32px}
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:20px}
        .form-group{margin-bottom:20px}
        .form-group.full{grid-column:1/-1}
        .form-label{display:block;font-size:14px;font-weight:600;margin-bottom:8px;color:var(--charcoal)}
        .form-input,.form-select,.form-textarea{width:100%;padding:12px 16px;border:2px solid var(--light-gray);border-radius:10px;font-size:14px;font-family:inherit}
        .form-input:focus,.form-select:focus,.form-textarea:focus{outline:none;border-color:var(--gold)}
        .form-textarea{min-height:300px;resize:vertical;line-height:1.6}
        .form-hint{font-size:12px;color:var(--warm-gray);margin-top:4px}
        .tag-input{display:flex;flex-wrap:wrap;gap:8px;padding:8px;border:2px solid var(--light-gray);border-radius:10px;min-height:48px;align-items:center}
        .tag{display:inline-flex;align-items:center;gap:4px;background:var(--racing-green);color:var(--white);padding:4px 10px;border-radius:6px;font-size:12px}
        .tag button{background:none;border:none;color:var(--white);cursor:pointer;padding:0;font-size:14px}
        .tag-input input{border:none;outline:none;flex:1;min-width:100px;padding:4px}
        .form-checkbox{display:flex;align-items:center;gap:10px}.form-checkbox input{width:18px;height:18px;accent-color:var(--racing-green)}
        .modal-footer{display:flex;justify-content:flex-end;gap:12px;padding:24px 32px;border-top:1px solid var(--light-gray);background:var(--light-gray)}
        
        @media(max-width:768px){.sidebar{display:none}.main{margin-left:0}.stats-row{grid-template-columns:1fr 1fr}.form-row{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div class="layout">
        <aside class="sidebar">
            <a href="admin.html" class="sidebar-logo">EquiMarket<span class="logo-badge">ADMIN</span></a>
            <div class="nav-section-title">Genel</div>
            <a href="admin.html" class="nav-link"><svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="9"/><rect x="14" y="3" width="7" height="5"/><rect x="14" y="12" width="7" height="9"/><rect x="3" y="16" width="7" height="5"/></svg>Dashboard</a>
            <div class="nav-section-title">Y√∂netim</div>
            <a href="admin_users.html" class="nav-link"><svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>Kullanƒ±cƒ±lar</a>
            <a href="admin_listings.html" class="nav-link"><svg viewBox="0 0 24 24"><path d="M20.5 6c-.2-1.5-1-2.5-2-3-.5-1.3-1.5-2-3-2-1 0-2 .5-2.5 1.3L11.5 4 9 3 5 5 3 8v5l2.5 2.5H9l4-2.5 3 1c2.2 0 3.5-1.5 3.5-4V6z"/></svg>ƒ∞lanlar</a>
            <a href="admin_blog.html" class="nav-link active"><svg viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>Blog</a>
            <div class="nav-section-title">Diƒüer</div>
            <a href="homepage_v2.html" class="nav-link"><svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/></svg>Siteye Git</a>
        </aside>
        <main class="main">
            <div class="page-header">
                <div><h1>Blog Y√∂netimi</h1></div>
                <button class="btn btn-primary" onclick="openModal()"><svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>Yeni Yazƒ±</button>
            </div>
            
            <div class="stats-row">
                <div class="stat-card"><div class="stat-value" id="statTotal">0</div><div class="stat-label">Toplam Yazƒ±</div></div>
                <div class="stat-card"><div class="stat-value" id="statPublished">0</div><div class="stat-label">Yayƒ±nda</div></div>
                <div class="stat-card"><div class="stat-value" id="statDraft">0</div><div class="stat-label">Taslak</div></div>
                <div class="stat-card"><div class="stat-value" id="statViews">0</div><div class="stat-label">Toplam G√∂r√ºnt√ºlenme</div></div>
            </div>

            <div class="filters">
                <input type="text" class="search-input" id="search" placeholder="Yazƒ± ara...">
                <select class="filter-select" id="statusFilter">
                    <option value="">T√ºm Durumlar</option>
                    <option value="published">Yayƒ±nda</option>
                    <option value="draft">Taslak</option>
                    <option value="archived">Ar≈üiv</option>
                </select>
            </div>

            <div class="card">
                <table class="table">
                    <thead><tr><th>Yazƒ±</th><th>Kategori</th><th>Durum</th><th>G√∂r√ºnt√ºlenme</th><th>Tarih</th><th>ƒ∞≈ülem</th></tr></thead>
                    <tbody id="blogsTable"><tr><td colspan="6" style="text-align:center;padding:40px">Y√ºkleniyor...</td></tr></tbody>
                </table>
                <div class="pagination"><span id="pageInfo">0 yazƒ±</span><div id="pageButtons"></div></div>
            </div>
        </main>
    </div>

    <!-- Blog Modal -->
    <div class="modal-overlay" id="blogModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle">Yeni Blog Yazƒ±sƒ±</h3>
                <button class="modal-close" onclick="closeModal()"><svg viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
            </div>
            <form id="blogForm" onsubmit="saveBlog(event)">
                <input type="hidden" id="blogId">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group full">
                            <label class="form-label">Ba≈ülƒ±k *</label>
                            <input type="text" class="form-input" id="blogTitle" required placeholder="Blog yazƒ±sƒ±nƒ±n ba≈ülƒ±ƒüƒ±">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Kategori</label>
                            <select class="form-select" id="blogCategory">
                                <option value="haberler">Haberler</option>
                                <option value="rehber">Rehber</option>
                                <option value="bakƒ±m">Bakƒ±m</option>
                                <option value="eƒüitim">Eƒüitim</option>
                                <option value="yarƒ±≈ü">Yarƒ±≈ü</option>
                                <option value="saƒülƒ±k">Saƒülƒ±k</option>
                                <option value="beslenme">Beslenme</option>
                                <option value="ekipman">Ekipman</option>
                                <option value="etkinlik">Etkinlik</option>
                                <option value="diƒüer">Diƒüer</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Durum</label>
                            <select class="form-select" id="blogStatus">
                                <option value="draft">Taslak</option>
                                <option value="published">Yayƒ±nla</option>
                                <option value="archived">Ar≈üivle</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Kapak G√∂rseli URL</label>
                        <input type="url" class="form-input" id="blogCover" placeholder="https://...">
                        <div class="form-hint">Resim y√ºkleme √∂zelliƒüi yakƒ±nda eklenecek. ≈ûimdilik URL girin.</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">√ñzet</label>
                        <input type="text" class="form-input" id="blogExcerpt" placeholder="Kƒ±sa a√ßƒ±klama (bo≈ü bƒ±rakƒ±lƒ±rsa otomatik olu≈üturulur)" maxlength="500">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Etiketler</label>
                        <div class="tag-input" id="tagInput" onclick="document.getElementById('tagField').focus()">
                            <input type="text" id="tagField" placeholder="Etiket yazƒ±p Enter'a basƒ±n">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ƒ∞√ßerik *</label>
                        <textarea class="form-textarea" id="blogContent" required placeholder="Blog i√ßeriƒüini buraya yazƒ±n. HTML kullanabilirsiniz."></textarea>
                        <div class="form-hint">HTML formatƒ±nda yazabilirsiniz: &lt;p&gt;, &lt;h2&gt;, &lt;ul&gt;, &lt;strong&gt;, &lt;a&gt; vb.</div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-checkbox"><input type="checkbox" id="blogFeatured"><span>√ñne √áƒ±kar</span></label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">ƒ∞ptal</button>
                    <button type="submit" class="btn btn-primary">Kaydet</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/admin.service.js"></script>
    <script src="js/toast.js"></script>
    <script>
        let page = 1, totalPages = 1, tags = [];

        document.addEventListener('DOMContentLoaded', async () => {
            if (api.isLoggedIn()) { try { const r=await api.get('/auth/me'); if(r.success&&r.data) api.setUser(r.data); } catch(e){} }
            const u = api.getUser();
            if (!u || u.role !== 'admin') { toast.error('Yetki yok'); setTimeout(()=>window.location.href='homepage_v2.html',1500); return; }
            
            loadBlogs();
            
            document.getElementById('search').addEventListener('input', debounce(() => { page = 1; loadBlogs(); }, 300));
            document.getElementById('statusFilter').addEventListener('change', () => { page = 1; loadBlogs(); });
            
            // Tag input
            document.getElementById('tagField').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const val = e.target.value.trim();
                    if (val && !tags.includes(val)) {
                        tags.push(val);
                        renderTags();
                    }
                    e.target.value = '';
                }
            });
        });

        async function loadBlogs() {
            let url = '/admin/blogs?page=' + page + '&limit=15';
            const s = document.getElementById('search').value;
            if (s) url += '&search=' + encodeURIComponent(s);
            const st = document.getElementById('statusFilter').value;
            if (st) url += '&status=' + st;

            try {
                const r = await api.get(url);
                if (r.success) {
                    totalPages = r.totalPages;
                    renderBlogs(r.data);
                    renderPages(r.total, r.currentPage, r.totalPages);
                    if (r.stats) {
                        document.getElementById('statTotal').textContent = r.stats.total;
                        document.getElementById('statPublished').textContent = r.stats.published;
                        document.getElementById('statDraft').textContent = r.stats.draft;
                        document.getElementById('statViews').textContent = r.stats.totalViews.toLocaleString('tr-TR');
                    }
                }
            } catch (e) { console.error(e); }
        }

        function renderBlogs(blogs) {
            const tb = document.getElementById('blogsTable');
            if (!blogs.length) {
                tb.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px">Hen√ºz blog yazƒ±sƒ± yok</td></tr>';
                return;
            }
            const labels = { published: 'Yayƒ±nda', draft: 'Taslak', archived: 'Ar≈üiv' };
            const catLabels = { haberler: 'Haberler', rehber: 'Rehber', bakƒ±m: 'Bakƒ±m', eƒüitim: 'Eƒüitim', yarƒ±≈ü: 'Yarƒ±≈ü', saƒülƒ±k: 'Saƒülƒ±k', beslenme: 'Beslenme', ekipman: 'Ekipman', etkinlik: 'Etkinlik', diƒüer: 'Diƒüer' };
            
            tb.innerHTML = blogs.map(b => `
                <tr>
                    <td>
                        <div class="blog-cell">
                            ${b.coverImage ? `<img src="${b.coverImage}" class="blog-img">` : '<div class="blog-img" style="display:flex;align-items:center;justify-content:center;color:var(--warm-gray)">üìù</div>'}
                            <div>
                                <strong>${b.title}</strong>
                                ${b.isFeatured ? '<span style="color:var(--gold);margin-left:8px">‚≠ê</span>' : ''}
                                <br><small style="color:var(--warm-gray)">${b.author?.name || 'Admin'}</small>
                            </div>
                        </div>
                    </td>
                    <td>${catLabels[b.category] || b.category}</td>
                    <td><span class="badge badge-${b.status}">${labels[b.status]}</span></td>
                    <td>${b.views.toLocaleString('tr-TR')}</td>
                    <td>${new Date(b.createdAt).toLocaleDateString('tr-TR')}</td>
                    <td>
                        <button class="action-btn" onclick="editBlog('${b._id}')"><svg viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button>
                        <button class="action-btn" onclick="window.open('blog_detail.html?slug=${b.slug}')"><svg viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button>
                        <button class="action-btn danger" onclick="deleteBlog('${b._id}','${b.title.replace(/'/g, "\\'")}')"><svg viewBox="0 0 24 24"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg></button>
                    </td>
                </tr>
            `).join('');
        }

        function renderPages(total, current, pages) {
            document.getElementById('pageInfo').textContent = total + ' yazƒ±';
            let html = '<button class="page-btn" onclick="goPage(' + (current - 1) + ')"' + (current <= 1 ? ' disabled' : '') + '>‚Üê</button>';
            for (let i = 1; i <= pages; i++) {
                if (i === 1 || i === pages || (i >= current - 1 && i <= current + 1)) {
                    html += '<button class="page-btn' + (i === current ? ' active' : '') + '" onclick="goPage(' + i + ')">' + i + '</button>';
                }
            }
            html += '<button class="page-btn" onclick="goPage(' + (current + 1) + ')"' + (current >= pages ? ' disabled' : '') + '>‚Üí</button>';
            document.getElementById('pageButtons').innerHTML = html;
        }

        function goPage(p) { if (p < 1 || p > totalPages) return; page = p; loadBlogs(); }

        function openModal(id = null) {
            document.getElementById('blogId').value = '';
            document.getElementById('blogTitle').value = '';
            document.getElementById('blogCategory').value = 'haberler';
            document.getElementById('blogStatus').value = 'draft';
            document.getElementById('blogCover').value = '';
            document.getElementById('blogExcerpt').value = '';
            document.getElementById('blogContent').value = '';
            document.getElementById('blogFeatured').checked = false;
            tags = [];
            renderTags();
            document.getElementById('modalTitle').textContent = 'Yeni Blog Yazƒ±sƒ±';
            document.getElementById('blogModal').classList.add('active');
        }

        async function editBlog(id) {
            try {
                const r = await api.get('/admin/blogs/' + id);
                if (r.success) {
                    const b = r.data;
                    document.getElementById('blogId').value = b._id;
                    document.getElementById('blogTitle').value = b.title;
                    document.getElementById('blogCategory').value = b.category;
                    document.getElementById('blogStatus').value = b.status;
                    document.getElementById('blogCover').value = b.coverImage || '';
                    document.getElementById('blogExcerpt').value = b.excerpt || '';
                    document.getElementById('blogContent').value = b.content;
                    document.getElementById('blogFeatured').checked = b.isFeatured;
                    tags = b.tags || [];
                    renderTags();
                    document.getElementById('modalTitle').textContent = 'Blog D√ºzenle';
                    document.getElementById('blogModal').classList.add('active');
                }
            } catch (e) { toast.error('Blog y√ºklenirken bir hata olu≈ütu'); }
        }

        function closeModal() {
            document.getElementById('blogModal').classList.remove('active');
        }

        function renderTags() {
            const container = document.getElementById('tagInput');
            const input = document.getElementById('tagField');
            container.innerHTML = '';
            tags.forEach((t, i) => {
                const tag = document.createElement('span');
                tag.className = 'tag';
                tag.innerHTML = t + '<button type="button" onclick="removeTag(' + i + ')">√ó</button>';
                container.appendChild(tag);
            });
            container.appendChild(input);
        }

        function removeTag(i) {
            tags.splice(i, 1);
            renderTags();
        }

        async function saveBlog(e) {
            e.preventDefault();
            const id = document.getElementById('blogId').value;
            const data = {
                title: document.getElementById('blogTitle').value,
                category: document.getElementById('blogCategory').value,
                status: document.getElementById('blogStatus').value,
                coverImage: document.getElementById('blogCover').value || null,
                excerpt: document.getElementById('blogExcerpt').value || null,
                content: document.getElementById('blogContent').value,
                isFeatured: document.getElementById('blogFeatured').checked,
                tags: tags
            };

            try {
                let r;
                if (id) {
                    r = await api.put('/admin/blogs/' + id, data);
                } else {
                    r = await api.post('/admin/blogs', data);
                }
                if (r.success) {
                    toast.success(id ? 'Blog yazƒ±sƒ± g√ºncellendi' : 'Blog yazƒ±sƒ± olu≈üturuldu');
                    closeModal();
                    loadBlogs();
                } else {
                    toast.error(r.message || 'ƒ∞≈ülem ba≈üarƒ±sƒ±z');
                }
            } catch (e) { toast.error('Kaydetme sƒ±rasƒ±nda bir hata olu≈ütu'); }
        }

        async function deleteBlog(id, title) {
            const ok = await toast.confirm('"' + title + '" yazƒ±sƒ± kalƒ±cƒ± olarak silinecek. Devam etmek istiyor musunuz?', {title:'Blog Yazƒ±sƒ±nƒ± Sil',confirmText:'Sil',cancelText:'ƒ∞ptal',type:'danger'});
            if (!ok) return;
            try {
                await api.delete('/admin/blogs/' + id);
                toast.success('Blog yazƒ±sƒ± silindi');
                loadBlogs();
            } catch (e) { toast.error('Silme i≈ülemi ba≈üarƒ±sƒ±z'); }
        }

        function debounce(fn, ms) { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), ms); }; }
    </script>
</body>
</html>
